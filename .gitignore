#include<stdio.h>
#include<intrin.h>


int main(void){

	int dwBuf[4] = {0}; // EAX EBX ECX EDX output
	int eax_value; // EAX input
	int ecx_value = 0; // ECX input

	unsigned int flag = 1; // loop control
	unsigned int count; // The count of array
	unsigned int checkSpecial[] = { 0x0D, 0x0F, 0x10, 0x14 }; // special value of EAX

	while (flag){

		printf("\nPlease enter a value as EAX input: ");
		scanf_s("%X", &eax_value); // assign eax_value 

		if (((eax_value >= 0x00) && (eax_value <= 0x16)) || ((eax_value >= 0x80000000) && (eax_value <= 0x80000008))) { // Limit of eax_value						

			for (count = 0; count < 4; count++){
				if (eax_value == checkSpecial[count]){ // check special value
					printf("Please enter a value as ECX input: ");
					scanf_s("%X", &ecx_value); // assign ecx_value
				}
			}

			__cpuidex(dwBuf, eax_value, ecx_value); // call library function __cpuidex(int [4], int, int)

			// Output four registers value
			printf("EAX: %8X", dwBuf[0]); 
			printf("\nEBX: %8X", dwBuf[1]);
			printf("\nECX: %8X", dwBuf[2]);
			printf("\nEDX: %8X", dwBuf[3]);
			
		}
		else
			printf("\nInput EAX value invalid !!! \n");
		    if (eax_value == -1){
				flag = 0;
		    }
	}
	return 0;
}
